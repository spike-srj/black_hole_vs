# 🌌 黑洞演示程序 - 开发指南

## ❓ **为什么直接运行 `.\blackhole_demo.exe` 没反应？**

### 🔍 **原因分析**
程序是用MinGW编译的，依赖以下运行时库：
- `libgcc_s_seh-1.dll` - GCC运行时库
- `libstdc++-6.dll` - C++标准库  
- `libwinpthread-1.dll` - 线程库
- `libglfw-3.dll` - GLFW图形库（可能）

这些库在MSYS2环境中会自动加载，但在普通PowerShell中不会。

### ✅ **解决方案**

#### **方案1: 复制DLL文件到程序目录**
运行这个脚本：
```bash
.\setup_dlls.bat
```

#### **方案2: 使用MSYS2环境**
```bash
C:\msys64\msys2_shell.cmd -defterm -here -no-start -mingw64 -c "./blackhole_demo.exe"
```

#### **方案3: 添加MinGW到系统PATH**
添加 `C:\msys64\mingw64\bin` 到系统环境变量PATH中。

---

## 🔧 **代码修改后如何重新编译？**

### **完整重编译流程**

#### **方法1: 使用自动化脚本（推荐）**
```bash
.\rebuild.bat
```
这个脚本会：
1. 清理旧的目标文件
2. 重新编译所有源文件
3. 链接生成新的可执行文件
4. 自动复制必要的DLL

#### **方法2: 手动编译**
在MSYS2环境中：
```bash
# 启动MSYS2
C:\msys64\msys2_shell.cmd -defterm -here -no-start -mingw64

# 清理
rm -f *.o blackhole_demo.exe

# 编译源文件
g++ -std=c++17 -I. -Iglm ffimage.cpp -c -o ffimage.o
g++ -std=c++17 -I. -Iglm Camera.cpp -c -o Camera.o  
g++ -std=c++17 -I. -Iglm Shader.cpp -c -o Shader.o
g++ -std=c++17 -I. -Iglm main_bh.cpp -c -o main_bh.o
gcc -c glad_loader.c -o glad_loader.o -I.

# 链接
g++ ffimage.o Camera.o Shader.o main_bh.o glad_loader.o -o blackhole_demo.exe \
    -lglfw3 -lopengl32 -lgdi32 -luser32 -lshell32
```

### **增量编译**
如果只修改了某个文件，可以只重新编译该文件：

**修改了main_bh.cpp：**
```bash
C:\msys64\msys2_shell.cmd -defterm -here -no-start -mingw64 -c "
g++ -std=c++17 -I. -Iglm main_bh.cpp -c -o main_bh.o;
g++ ffimage.o Camera.o Shader.o main_bh.o glad_loader.o -o blackhole_demo.exe -lglfw3 -lopengl32 -lgdi32 -luser32 -lshell32
"
```

**修改了着色器文件：**
着色器文件在运行时加载，不需要重新编译，直接运行程序即可看到效果。

---

## 🚀 **运行程序的方法**

### **方法1: 直接运行（需要DLL）**
```bash
.\blackhole_demo.exe
```

### **方法2: 使用启动脚本**
```bash
.\start_blackhole.bat
```

### **方法3: 简单脚本**
```bash
.\run_simple.bat
```

### **方法4: MSYS2环境**
```bash
C:\msys64\msys2_shell.cmd -defterm -here -no-start -mingw64 -c "./blackhole_demo.exe"
```

---

## 📁 **项目文件说明**

### **核心源文件**
- `main_bh.cpp` - 主程序，包含渲染循环和黑洞效果
- `Camera.cpp/h` - 相机系统
- `Shader.cpp/h` - 着色器管理
- `ffimage.cpp/h` - 图像加载
- `glad_loader.c` - 自定义OpenGL函数加载器

### **着色器文件** (`shader/`)
- `blackholev.glsl` - 黑洞顶点着色器
- `blackholef.glsl` - 黑洞片段着色器（主要效果）
- `skyShaderv.glsl` - 天空盒顶点着色器  
- `skyShaderf.glsl` - 天空盒片段着色器

### **资源文件** (`res/`)
- `skybox3/` - 天空盒纹理文件（6个.jpg文件）

### **构建脚本**
- `rebuild.bat` - 完整重新编译
- `setup_dlls.bat` - 复制运行时库
- `start_blackhole.bat` - 启动程序（带说明）
- `run_simple.bat` - 简单启动脚本

---

## 🎯 **开发技巧**

### **调试信息**
程序运行时会在控制台输出：
- FPS（每秒帧数）
- 到黑洞的距离（史瓦西半径单位）
- 相机位置坐标

### **修改效果的地方**
1. **物理参数**: `main_bh.cpp` 中的黑洞质量、距离等
2. **视觉效果**: `shader/blackholef.glsl` 中的着色器代码
3. **相机运动**: `Camera.cpp` 中的相机控制逻辑
4. **天空盒**: `res/skybox3/` 中的纹理文件

### **常见修改示例**
**改变黑洞大小：**
修改 `main_bh.cpp` 中的黑洞半径参数

**改变天空盒：**
替换 `res/skybox3/` 中的6个jpg文件

**修改引力效果：**
编辑 `shader/blackholef.glsl` 中的光线弯曲计算

---

## 🔧 **故障排除**

### **编译错误**
- 确保MSYS2正确安装
- 检查GLFW库是否安装：`pacman -S mingw-w64-x86_64-glfw`

### **运行时错误**
- 确保所有DLL文件在程序目录
- 检查着色器文件是否存在
- 验证资源文件路径

### **性能问题**
- 当前FPS约11-12，可以通过优化着色器提升
- 检查显卡驱动是否支持OpenGL 3.3+

---

## 📝 **快速命令参考**

```bash
# 完整重新编译
.\rebuild.bat

# 设置运行环境
.\setup_dlls.bat

# 运行程序
.\blackhole_demo.exe

# 或使用MSYS2
C:\msys64\msys2_shell.cmd -defterm -here -no-start -mingw64 -c "./blackhole_demo.exe"
```

现在你应该能够顺利地开发和运行黑洞演示程序了！🌌 